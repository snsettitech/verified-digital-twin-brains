# =============================================================================
# Verified Digital Twin Brain - Environment Configuration
# =============================================================================

# ---------------------------------------------------------------------------
# REQUIRED: Core API Keys
# ---------------------------------------------------------------------------

# OpenAI API Key (Required for embeddings and LLM)
OPENAI_API_KEY=sk-your-openai-key-here

# Pinecone Configuration (Required for vector storage)
PINECONE_API_KEY=pcsk-your-pinecone-key-here
PINECONE_HOST=https://digitalminds-nrnzovv.svc.aped-4627-b74a.pinecone.io
PINECONE_INDEX_NAME=digitalminds
PINECONE_INDEX_MODE=integrated
PINECONE_TEXT_FIELD=chunk_text
# Optional fallback: set PINECONE_INDEX_MODE=vector for legacy external-embedding path

# Supabase Configuration (Required for database)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-service-key

# Cohere API Key (REQUIRED for production reranking)
# Get yours at: https://dashboard.cohere.com/api-keys
COHERE_API_KEY=your-cohere-key-here

# ---------------------------------------------------------------------------
# RERANKING CONFIGURATION (All 7 Improvements Implemented)
# ---------------------------------------------------------------------------

# Cohere Rerank Settings
ENABLE_COHERE_RERANK=true
COHERE_RERANK_MODEL=rerank-v3.5
COHERE_RERANK_TIMEOUT_SECONDS=5.0

# STRICT MODE: If true, throws error if Cohere unavailable (recommended for production)
COHERE_RERANK_STRICT=true

# FlashRank Local Reranker (Fallback)
ENABLE_FLASHRANK=true

# Hybrid Ensemble Weights (when both Cohere and FlashRank available)
HYBRID_COHERE_WEIGHT=0.7
HYBRID_FLASHRANK_WEIGHT=0.3

# Selective Reranking (skip reranking if initial confidence high)
SELECTIVE_RERANKING_ENABLED=true
SELECTIVE_RERANKING_THRESHOLD=0.75

# Reranking Cache
RERANK_CACHE_ENABLED=true
RERANK_CACHE_MAXSIZE=1000

# ---------------------------------------------------------------------------
# QUERY REWRITING FOR CONVERSATIONAL CONTEXT (Latest GPT Models)
# ---------------------------------------------------------------------------

# Enable conversational query rewriting
QUERY_REWRITING_ENABLED=false

# LLM Model Selection (Latest as of Feb 2026):
#   gpt-4o          - Latest flagship (best quality, recommended)
#   gpt-4o-mini     - Cost-effective (30x cheaper, good for high volume)
#   o1-preview      - NOT recommended (too slow for query rewriting)
#   o1-mini         - NOT recommended (slower than 4o)
QUERY_REWRITING_MODEL=gpt-4o

# Maximum conversation history turns to consider
QUERY_REWRITING_MAX_HISTORY=5

# Minimum confidence threshold (0.0-1.0) - higher = more strict
QUERY_REWRITING_MIN_CONFIDENCE=0.7

# Timeout for LLM rewriting (seconds)
QUERY_REWRITING_TIMEOUT=3.0

# Caching Configuration
QUERY_REWRITE_CACHE_ENABLED=true
QUERY_REWRITE_CACHE_SIZE=1000
QUERY_REWRITE_CACHE_TTL_SECONDS=300

# A/B Testing
QUERY_REWRITE_AB_TEST_ENABLED=false
QUERY_REWRITE_ROLLOUT_PERCENT=0

# ---------------------------------------------------------------------------
# OPTIONAL: Additional Services
# ---------------------------------------------------------------------------

# JWT Secret (Required for auth)
JWT_SECRET=your-jwt-secret-here

# Langfuse Observability (Optional)
LANGFUSE_PUBLIC_KEY=pk-lf-...
LANGFUSE_SECRET_KEY=sk-lf-...
LANGFUSE_HOST=https://cloud.langfuse.com

# ElevenLabs Voice (Optional)
ELEVENLABS_API_KEY=your-elevenlabs-key

# YouTube/Google (Optional - for enhanced YouTube ingestion)
GOOGLE_API_KEY=your-google-api-key
YOUTUBE_COOKIES_FILE=path/to/cookies.txt
YOUTUBE_MAX_RETRIES=5

# Redis (Optional - for caching)
REDIS_URL=rediss://default:password@host:6379

# ---------------------------------------------------------------------------
# RETRIEVAL CONFIGURATION
# ---------------------------------------------------------------------------

# Namespace Configuration
DELPHI_DUAL_READ=true

# Timeouts
RETRIEVAL_QUERY_PREP_TIMEOUT_SECONDS=6.0
RETRIEVAL_EMBEDDING_TIMEOUT_SECONDS=10.0
RETRIEVAL_VECTOR_TIMEOUT_SECONDS=20.0
RETRIEVAL_PER_NAMESPACE_TIMEOUT_SECONDS=8.0

# Retrieval Parameters
RETRIEVAL_TOP_K_GENERAL=8
RETRIEVAL_TOP_K_VERIFIED=3
RETRIEVAL_MMR_ENABLED=true
RETRIEVAL_MMR_LAMBDA=0.72
RETRIEVAL_LEXICAL_FUSION_ENABLED=true
RETRIEVAL_LEXICAL_FUSION_ALPHA=0.22

# ---------------------------------------------------------------------------
# FEATURE FLAGS
# ---------------------------------------------------------------------------

ENABLE_REALTIME_INGESTION=true
ENABLE_ENHANCED_INGESTION=false
ENABLE_DELPHI_RETRIEVAL=true
ENABLE_VC_ROUTES=false

# ---------------------------------------------------------------------------
# DEPLOYMENT
# ---------------------------------------------------------------------------

PORT=8000
HOST=0.0.0.0

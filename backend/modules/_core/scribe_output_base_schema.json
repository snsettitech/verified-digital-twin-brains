{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "ScribeOutputBaseSchema",
    "description": "Generic structured output schema for all specializations. VC (and others) supply node/edge types via packs; this base schema defines the shape.",
    "type": "object",
    "properties": {
        "node_updates": {
            "type": "array",
            "description": "New or updated nodes to write to the cognitive graph.",
            "items": {
                "type": "object",
                "properties": {
                    "node_id": {
                        "type": "string"
                    },
                    "node_type": {
                        "type": "string"
                    },
                    "label": {
                        "type": "string"
                    },
                    "properties": {
                        "type": "object"
                    },
                    "confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    },
                    "source_turn_id": {
                        "type": "string"
                    }
                },
                "required": [
                    "node_type",
                    "label"
                ]
            }
        },
        "edge_updates": {
            "type": "array",
            "description": "New or updated edges linking nodes.",
            "items": {
                "type": "object",
                "properties": {
                    "edge_id": {
                        "type": "string"
                    },
                    "edge_type": {
                        "type": "string"
                    },
                    "source_node_id": {
                        "type": "string"
                    },
                    "target_node_id": {
                        "type": "string"
                    },
                    "properties": {
                        "type": "object"
                    },
                    "confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    }
                },
                "required": [
                    "edge_type",
                    "source_node_id",
                    "target_node_id"
                ]
            }
        },
        "narratives": {
            "type": "array",
            "description": "Free-text summaries or explanations linked to clusters.",
            "items": {
                "type": "object",
                "properties": {
                    "cluster_id": {
                        "type": "string"
                    },
                    "text": {
                        "type": "string"
                    },
                    "confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    }
                },
                "required": [
                    "cluster_id",
                    "text"
                ]
            }
        },
        "contradictions": {
            "type": "array",
            "description": "Detected conflicts between new data and existing graph.",
            "items": {
                "type": "object",
                "properties": {
                    "existing_node_id": {
                        "type": "string"
                    },
                    "new_value": {
                        "type": "string"
                    },
                    "old_value": {
                        "type": "string"
                    },
                    "field": {
                        "type": "string"
                    },
                    "severity": {
                        "type": "string",
                        "enum": [
                            "low",
                            "medium",
                            "high"
                        ]
                    }
                },
                "required": [
                    "existing_node_id",
                    "new_value",
                    "old_value",
                    "field"
                ]
            }
        },
        "missing_slots": {
            "type": "array",
            "description": "Required slots that were not filled by the user in this turn.",
            "items": {
                "type": "object",
                "properties": {
                    "slot_id": {
                        "type": "string"
                    },
                    "cluster_id": {
                        "type": "string"
                    },
                    "prompt_hint": {
                        "type": "string"
                    }
                },
                "required": [
                    "slot_id"
                ]
            }
        }
    },
    "required": [
        "node_updates",
        "edge_updates",
        "narratives",
        "contradictions",
        "missing_slots"
    ]
}
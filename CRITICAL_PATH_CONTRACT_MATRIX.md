# Critical Path Contract Matrix

Last updated: 2026-02-04

Purpose: Map every frontend network call to its backend handler and document the FE/BE contract for the critical path: (1) create a digital twin, (2) ingest data with correct artifacts (sources, chunks, vectors, graph/nodes), (3) retrieve data via public chat. This file also enumerates every backend API route and every frontend call site.

**Critical Path Definition**

1. Create a digital twin: `/auth/sync-user`, `/auth/my-twins`, `/twins`.
2. Ingest data and build artifacts: `/ingest/*`, `/sources/*`, `/training-jobs/*`, `/ingest/extract-nodes`, `/twins/{twin_id}/graph`, `/twins/{twin_id}/graph-stats`, `/twins/{twin_id}/verification-status`.
3. Public retrieval: `/public/validate-share`, `/twins/{twin_id}/share-link`, `/twins/{twin_id}/sharing`, `/public/chat/{twin_id}/{token}`, `/chat-widget/{twin_id}`.

**Common Auth, Headers, and Error Contract**

- Owner-authenticated endpoints require `Authorization: Bearer <Supabase JWT>` (generated by `useAuthFetch` or `authFetchStandalone`). See `frontend/lib/hooks/useAuthFetch.ts` and `backend/modules/auth_guard.py`.
- Public widget endpoints use API keys: request body `api_key` and server-side validation; `Origin` is checked against `allowed_domains` when configured. See `backend/routers/chat.py`.
- Share-link endpoints use URL token (`/public/validate-share/{twin_id}/{token}`, `/public/chat/{twin_id}/{token}`) and do not require bearer auth.
- Standard error shape for FastAPI `HTTPException` is `{"detail": "<message>"}`; streaming chat emits `{"type":"error","error":"..."}`.
- Archived twins return `410` from `ensure_twin_active` on chat/widget/public endpoints.

**Critical Path Contract Table**

| Step | Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Create twin | `frontend/lib/context/TwinContext.tsx`, `frontend/app/onboarding/page.tsx`, `frontend/app/auth/callback/route.ts` | `POST /auth/sync-user` | `Authorization: Bearer <JWT>` | Tenant resolved server-side via `resolve_tenant_id` | Body: none. Uses bearer JWT. | `{ status: "created"|"exists", user: { id: string, email: string, full_name?: string, avatar_url?: string, tenant_id?: string, onboarding_completed: boolean, created_at?: string }, needs_onboarding: boolean }` | 401/403 auth; 503 user/tenant create; 500 | None (used in FE) |
| Create twin | `frontend/lib/context/TwinContext.tsx`, `frontend/app/onboarding/page.tsx`, `frontend/scripts/simulator_repro.mjs` | `GET /auth/my-twins` | `Authorization: Bearer <JWT>` | Tenant resolved server-side | Body: none | `Array<Twin>` (Supabase row; fields include `id`, `name`, `tenant_id`, `description`, `specialization`, `settings`, `created_at`, `updated_at`) | 401/403; 200 empty list on failure to resolve tenant | None |
| Create twin | `frontend/app/onboarding/page.tsx`, `frontend/app/dashboard/right-brain/page.tsx`, `frontend/scripts/simulator_repro.mjs` | `POST /twins` | `Authorization: Bearer <JWT>` | Tenant resolved server-side; client `tenant_id` ignored | `{ name: string, tenant_id?: string (ignored), description?: string, specialization?: string, settings?: object }` | Twin row object as inserted | 401 if no user, 400 if insert fails, 500 | FE sometimes sends `tenant_id` (ignored but logged). See `frontend/app/dashboard/right-brain/page.tsx`. |
| Ingest start | `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/file/{twin_id}` | `Authorization: Bearer <JWT>` | Twin path param; ownership enforced | Multipart `file`; query `auto_index` boolean | `{ source_id: string, status: "live"|"staged" }` | 400 ingest error; 401/403; 500 | None |
| Ingest start | `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/url/{twin_id}` | `Authorization: Bearer <JWT>` | Twin path param | `{ url: string }` | `{ source_id: string, status: "live" }` | 400/401/403/500 | None |
| Ingest start | `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/youtube|podcast|x/{twin_id}` | `Authorization: Bearer <JWT>` | Twin path param | `{ url: string }` | `{ source_id: string, status: "processing" }` | 400/401/403/500 | None |
| Ingest artifacts | `frontend/app/dashboard/knowledge/page.tsx`, `frontend/app/dashboard/knowledge/staging/page.tsx`, `frontend/app/dashboard/knowledge/[source_id]/page.tsx`, `frontend/app/dashboard/training-jobs/page.tsx` | `GET /sources/{twin_id}` | `Authorization: Bearer <JWT>` | Twin path param | Query: `status?: string` | `Array<Source>` (Supabase row fields; at least `id`, `twin_id`, `filename?`, `file_size?`, `status`, `created_at?`, plus `staging_status`, `health_status`, `content_text`, metadata) | 401/403/500 | None |
| Ingest artifacts | `frontend/app/dashboard/knowledge/[source_id]/page.tsx`, `frontend/app/dashboard/knowledge/staging/page.tsx` | `POST /sources/{source_id}/approve` | `Authorization: Bearer <JWT>` | Source ownership via twin | Body: none | `{ status: "success", job_id: string }` | 404 if source missing; 500 | None |
| Ingest artifacts | `frontend/app/dashboard/knowledge/[source_id]/page.tsx`, `frontend/app/dashboard/knowledge/staging/page.tsx` | `POST /sources/{source_id}/reject` | `Authorization: Bearer <JWT>` | Source ownership via twin | Query param `reason?: string` | `{ status: "success", message: string }` | 404 if source missing; 500 | FE sends JSON body `{reason}`; backend expects query param. See `frontend/app/dashboard/knowledge/[source_id]/page.tsx`. |
| Ingest artifacts | `frontend/app/dashboard/knowledge/staging/page.tsx` | `POST /sources/bulk-approve` | `Authorization: Bearer <JWT>` | Tenant of authenticated owner | Body: `Array<string>` of `source_ids` | `{ status: "success", results: Array<any> }` | 500 | FE sends `{ source_ids: [...] }` object; backend expects raw list. See `frontend/app/dashboard/knowledge/staging/page.tsx`. |
| Ingest artifacts | `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `GET /sources/{source_id}/health` | `Authorization: Bearer <JWT>` | Source ownership via twin | None | `{ health_status: string|null, staging_status: string|null, logs: Array<IngestionLog> }` | 404/500 | FE expects `health.checks` array. See `frontend/app/dashboard/knowledge/[source_id]/page.tsx`. |
| Ingest artifacts | `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `GET /sources/{source_id}/logs` | `Authorization: Bearer <JWT>` | Source ownership via twin | None | `Array<IngestionLog>` | 404/500 | None |
| Ingest artifacts | `frontend/app/dashboard/training-jobs/page.tsx`, `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `POST /training-jobs/process-queue` | `Authorization: Bearer <JWT>` | Optional `twin_id` query param | Query `twin_id?: string` | `{ status: "success"|"partial"|"error", processed: number, failed: number, remaining: number, errors: Array<any>, message?: string }` | Always 200; status field indicates error | None |
| Ingest artifacts | `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/extract-nodes/{source_id}` | `Authorization: Bearer <JWT>` | Source ownership via twin | `{ max_chunks?: number }` | `{ status: "success", source_id: string, nodes_created: number, edges_created: number, chunks_processed: number, confidence: number }` | 404/400/500 | FE expects `nodes` array. See `frontend/components/ingestion/UnifiedIngestion.tsx`. |
| Ingest artifacts | `frontend/components/Brain/BrainGraph.tsx`, `frontend/app/dashboard/brain/page.tsx` | `GET /twins/{twin_id}/graph` | `Authorization: Bearer <JWT>` | Twin access | Query `limit?: number` | `{ nodes: Array<any>, edges: Array<any>, stats: { node_count: number, edge_count: number } }` | 500 | None |
| Ingest artifacts | `frontend/components/Chat/GraphContext.tsx` | `GET /twins/{twin_id}/graph-stats` | `Authorization: Bearer <JWT>` | Twin access | None | `{ node_count: number, has_graph: boolean, top_nodes: Array<any>, error?: string }` | 200 on error with `error` field | None |
| Ingest readiness | `frontend/components/console/tabs/PublishTab.tsx` | `GET /twins/{twin_id}/verification-status` | `Authorization: Bearer <JWT>` | Twin access | None | `{ vectors_count: number, graph_nodes: number, is_ready: boolean, issues: Array<string>, last_verified_at?: string, last_verified_status?: string }` | 200 with issues array | FE expects `counts.vectors/chunks/live_sources`. See `frontend/components/console/tabs/PublishTab.tsx`. |
| Owner retrieval | `frontend/components/Chat/ChatInterface.tsx`, `frontend/components/Chat/ChatWidget.tsx`, `frontend/components/onboarding/steps/PreviewTwinStep.tsx`, `frontend/components/console/tabs/ChatTab.tsx`, `frontend/app/dashboard/access-groups/[group_id]/console/page.tsx` | `POST /chat/{twin_id}` | `Authorization: Bearer <JWT>` | Twin access; optional `group_id` | `{ query: string, conversation_id?: string, group_id?: string, metadata?: object, mode?: "owner"|"public" }` | NDJSON stream events: `metadata/answer_metadata`, `content/answer_token`, `clarify`, `done`, `error` | 401/403; 410 if archived | PreviewTwinStep sends `{message}` and expects JSON, not stream. See `frontend/components/onboarding/steps/PreviewTwinStep.tsx`. |
| Public retrieval | `frontend/app/share/[twin_id]/[token]/page.tsx` | `POST /public/chat/{twin_id}/{token}` | Share token in path; no bearer | Share token validated server-side; uses public group | `{ message: string, conversation_history?: Array<{role: string, content: string}> }` | `{ status: "answer"|"queued", response?: string, citations?: string[], clarification_id?: string, question?: string, options?: Array<any>, owner_memory_refs?: Array<string>, owner_memory_topics?: Array<string>, used_owner_memory?: boolean }` | 403 invalid token; 429 rate limit; 500 | None |
| Public retrieval | `frontend/public/widget.js` | `POST /chat-widget/{twin_id}` | Body includes `api_key`; no bearer | API key validated; domain allowlist check via Origin header | `{ query: string, session_id?: string, api_key: string }` | NDJSON stream: `content` tokens; may emit `clarify` and includes `session_id` in events | 401 invalid key; 403 domain; 429 rate limit; 410 if archived | FE expects `type:"content"` and `session_id` in stream; backend emits `answer_token`/`answer_metadata` and `session_id` in clarify event. See `frontend/public/widget.js`. |
| Public retrieval | `frontend/app/share/[twin_id]/[token]/page.tsx` | `GET /public/validate-share/{twin_id}/{token}` | No bearer | Validates share token | `{ valid: boolean, twin_id: string, share_token: string, group_id?: string }` | 403 invalid token | None |
| Public retrieval | `frontend/app/dashboard/settings/page.tsx` | `GET /twins/{twin_id}/share-link`, `POST /twins/{twin_id}/share-link`, `PATCH /twins/{twin_id}/sharing` | `Authorization: Bearer <JWT>` | Twin access | No body for GET; POST: `{ regenerate?: boolean }` (implicit); PATCH: `{ public_share_enabled: boolean }` | `ShareLinkResponse`: `{ twin_id: string, share_token?: string, share_url?: string, public_share_enabled: boolean }` | 401/403/404 | None |
**Full Frontend Call Matrix**

Auth and user

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/auth/callback/route.ts`, `frontend/lib/context/TwinContext.tsx`, `frontend/app/onboarding/page.tsx` | `POST /auth/sync-user` | Bearer JWT | Tenant resolved server-side | Body none | SyncUserResponse | 401/503/500 | None |
| `frontend/lib/context/TwinContext.tsx`, `frontend/app/onboarding/page.tsx`, `frontend/scripts/simulator_repro.mjs` | `GET /auth/my-twins` | Bearer JWT | Tenant resolved server-side | None | `Array<Twin>` | 401/403 | None |
| `frontend/app/auth/accept-invitation/[token]/page.tsx` | `GET /auth/invitation/{token}` | None | N/A | None | Unknown | 404 | Missing backend route |
| `frontend/app/auth/accept-invitation/[token]/page.tsx` | `POST /auth/accept-invitation` | None | N/A | `{ token: string }` | Unknown | 404 | Missing backend route |
| `frontend/app/dashboard/users/page.tsx` | `GET /users` | Bearer JWT | Tenant scope | None | `Array<User>` | 401/403 | None |
| `frontend/app/dashboard/users/page.tsx` | `POST /users/invite` | Bearer JWT | Tenant scope | `{ email: string, role: "owner"|"viewer" }` | `UserInvitationSchema` | 401/403/500 | None |
| `frontend/app/dashboard/users/page.tsx` | `DELETE /users/{user_id}` | Bearer JWT | Tenant scope | None | `{ status: "success" }` | 401/403/500 | None |
| `frontend/app/dashboard/users/page.tsx` | `PATCH /users/{user_id}/role` | Bearer JWT | Tenant scope | `{ role: string }` | Unknown | 404 | Missing backend route |
| `frontend/app/dashboard/settings/page.tsx` | `POST /account/delete` | Bearer JWT | Tenant scope | Body none | `{ status: "success" }` | 401/403/500 | None |
| `frontend/app/dashboard/actions/page.tsx` | `GET /connectors` | Bearer JWT | Tenant scope | None | `[]` (stub) | 200 | Backend stub returns empty list |

Twins and specialization

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/components/onboarding/steps/ChooseSpecializationStep.tsx` | `GET /specializations` | None | N/A | None | `Array<Specialization>` | 200 | None |
| `frontend/app/onboarding/page.tsx`, `frontend/app/dashboard/right-brain/page.tsx` | `POST /twins` | Bearer JWT | Tenant resolved server-side | TwinCreateRequest | Twin row | 401/400/500 | FE sometimes sends `tenant_id`, ignored |
| `frontend/app/onboarding/page.tsx`, `frontend/app/dashboard/twins/[id]/page.tsx`, `frontend/app/dashboard/settings/page.tsx` | `PATCH /twins/{twin_id}` | Bearer JWT | Twin path param | TwinSettingsUpdate `{ name?, description?, specialization_id?, is_public?, settings? }` | Twin row | 401/403/500 | None |
| `frontend/app/dashboard/twins/[id]/page.tsx` | `GET /twins/{twin_id}` | Bearer JWT | Twin access | None | Twin row | 401/403/404 | None |
| `frontend/app/dashboard/settings/page.tsx` | `GET /twins/{twin_id}/export` | Bearer JWT | Twin access | None | File download | 401/403/500 | None |
| `frontend/components/Chat/GraphContext.tsx` | `GET /twins/{twin_id}/graph-stats` | Bearer JWT | Twin access | None | `{ node_count, has_graph, top_nodes }` | 200 | None |
| `frontend/components/console/tabs/PublishTab.tsx` | `GET /twins/{twin_id}/verification-status` | Bearer JWT | Twin access | None | `{ vectors_count, graph_nodes, is_ready, issues, last_verified_at?, last_verified_status? }` | 200 | FE expects `counts` object |
| `frontend/contexts/SpecializationContext.tsx` | `GET /twins/{twin_id}/specialization` | Bearer JWT | Twin access | None | Specialization config | 401/403 | None |

Ingestion, sources, training jobs

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/onboarding/page.tsx` | `POST /ingest/document` | Bearer JWT | Unknown | `{ content: string }` | Unknown | 404 | Missing backend route |
| `frontend/app/onboarding/page.tsx` | `POST /ingest/url` | Bearer JWT | Unknown | `{ url: string }` | Unknown | 404 | Missing backend route (backend expects `/ingest/url/{twin_id}`) |
| `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/file/{twin_id}` | Bearer JWT | Twin path param | Multipart `file`, query `auto_index` | `{ source_id, status }` | 400/401/403 | None |
| `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/url/{twin_id}` | Bearer JWT | Twin path param | `{ url }` | `{ source_id, status }` | 400/401/403 | None |
| `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/youtube|podcast|x/{twin_id}` | Bearer JWT | Twin path param | `{ url }` | `{ source_id, status }` | 400/401/403 | None |
| `frontend/components/ingestion/UnifiedIngestion.tsx` | `POST /ingest/extract-nodes/{source_id}` | Bearer JWT | Source ownership | `{ max_chunks?: number }` | `{ status, source_id, nodes_created, edges_created, chunks_processed, confidence }` | 400/404/500 | FE expects `nodes` array |
| `frontend/app/dashboard/knowledge/page.tsx` | `GET /sources/{twin_id}` | Bearer JWT | Twin path param | Query `status?` | `Array<Source>` | 401/403/500 | None |
| `frontend/app/dashboard/knowledge/page.tsx` | `DELETE /sources/{twin_id}/{source_id}` | Bearer JWT | Twin path param | None | `{ status: "success", message: string }` | 500 | None |
| `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `GET /sources/{source_id}/health` | Bearer JWT | Source ownership | None | `{ health_status, staging_status, logs }` | 404/500 | FE expects `health.checks` |
| `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `GET /sources/{source_id}/logs` | Bearer JWT | Source ownership | None | `Array<IngestionLog>` | 404/500 | None |
| `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `POST /sources/{source_id}/approve` | Bearer JWT | Source ownership | None | `{ status, job_id }` | 404/500 | None |
| `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `POST /sources/{source_id}/reject` | Bearer JWT | Source ownership | Query param `reason` | `{ status, message }` | 404/500 | FE sends JSON `{reason}` |
| `frontend/app/dashboard/knowledge/staging/page.tsx` | `POST /sources/bulk-approve` | Bearer JWT | Tenant scope | Body: `Array<string>` | `{ status, results }` | 500 | FE sends `{ source_ids }` object |
| `frontend/app/dashboard/knowledge/staging/page.tsx` | `POST /sources/{source_id}/re-extract` | Bearer JWT | Source ownership | None | `{ status, message }` | 500 | None |
| `frontend/app/dashboard/training-jobs/page.tsx`, `frontend/app/dashboard/knowledge/[source_id]/page.tsx` | `GET /training-jobs?twin_id=...` | Bearer JWT | Twin scope | Query `twin_id` | `Array<TrainingJob>` | 404 | Missing backend route (only `GET /training-jobs/{job_id}` exists) |
| `frontend/app/dashboard/training-jobs/page.tsx` | `POST /training-jobs/{job_id}/retry` | Bearer JWT | Twin scope | None | Unknown | 404 | Missing backend route |
| `frontend/app/dashboard/training-jobs/page.tsx` | `POST /training-jobs/process-queue?twin_id=...` | Bearer JWT | Twin scope | Query `twin_id` | `{ status, processed, failed, remaining, errors, message? }` | 200 always | None |
Chat and retrieval

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/components/Chat/ChatInterface.tsx` | `GET /conversations/{conversation_id}/messages` | Bearer JWT | Conversation ownership | None | `Array<MessageSchema>` | 401/403/404 | None |
| `frontend/components/Chat/ChatInterface.tsx`, `frontend/components/Chat/ChatWidget.tsx`, `frontend/components/onboarding/steps/PreviewTwinStep.tsx`, `frontend/components/console/tabs/ChatTab.tsx`, `frontend/app/dashboard/access-groups/[group_id]/console/page.tsx` | `POST /chat/{twin_id}` | Bearer JWT | Twin access | `{ query, conversation_id?, group_id?, metadata?, mode? }` | NDJSON stream | 401/403/410 | PreviewTwinStep sends `{message}` + expects JSON |
| `frontend/public/widget.js` | `POST /chat-widget/{twin_id}` | Body `api_key`, `Origin` header | API key + domain | `{ query, session_id?, api_key }` | NDJSON stream | 401/403/429 | FE expects `type: content`, backend emits `answer_token` in main stream |
| `frontend/app/share/[twin_id]/[token]/page.tsx` | `GET /public/validate-share/{twin_id}/{token}` | None | Token in path | None | `{ valid, twin_id, share_token, group_id? }` | 403 | None |
| `frontend/app/share/[twin_id]/[token]/page.tsx` | `POST /public/chat/{twin_id}/{token}` | None | Token in path | `{ message, conversation_history? }` | `{ status, response?, citations? }` | 403/429/500 | None |
| `frontend/components/Chat/InterviewInterface.tsx` | `POST /cognitive/interview/{twin_id}` | Bearer JWT | Twin access | `{ response, confidence?, extracted_data?, conversation_id? }` | `InterviewResponse` | 401/403/500 | None |
| `frontend/components/Chat/GraphContext.tsx` | `GET /twins/{twin_id}/graph-stats` | Bearer JWT | Twin access | None | `{ node_count, has_graph, top_nodes }` | 200 | None |

Owner memory and clarifications

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/components/console/tabs/TrainingTab.tsx` | `GET /twins/{twin_id}/clarifications` | Bearer JWT | Twin access | Query `status?` | `Array<ClarificationThreadSchema>` | 401/403 | None |
| `frontend/components/console/tabs/TrainingTab.tsx`, `frontend/components/Chat/ChatInterface.tsx` | `POST /twins/{twin_id}/clarifications/{clarification_id}/resolve` | Bearer JWT | Twin access | `{ answer: string, selected_option?: string }` | `{ status: "applied", owner_memory_id, topic, memory_type, value }` | 400/404/422/500 | None |
| `frontend/components/console/tabs/TrainingTab.tsx` | `GET /twins/{twin_id}/owner-memory` | Bearer JWT | Twin access | Query `status?` | `Array<OwnerMemorySchema>` | 401/403 | None |
| `frontend/components/console/tabs/TrainingTab.tsx` | `DELETE /twins/{twin_id}/owner-memory/{memory_id}` | Bearer JWT | Twin access | None | `{ status: "retracted", memory_id }` | 500 | None |

Knowledge and verified QnA

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/dashboard/knowledge/page.tsx` | `GET /twins/{twin_id}/knowledge-profile` | Bearer JWT | Twin access | None | `KnowledgeProfile` | 401/403/500 | None |
| `frontend/app/dashboard/verified-qna/page.tsx` | `GET /twins/{twin_id}/verified-qna` | Bearer JWT | Twin access | Query `visibility?` | `Array<VerifiedQnASchema>` | 401/403/500 | None |
| `frontend/app/onboarding/page.tsx` | `POST /twins/{twin_id}/verified-qna` | Bearer JWT | Twin access | `{ question, answer, citations?, visibility? }` | `VerifiedQnASchema` | 404 | Missing backend route (no POST exists) |
| `frontend/app/dashboard/verified-qna/page.tsx` | `PATCH /verified-qna/{qna_id}` | Bearer JWT | Twin access via ownership | `{ answer: string, reason: string }` | `{ status: "success", message }` | 404/500 | None |
| `frontend/app/dashboard/verified-qna/page.tsx` | `DELETE /verified-qna/{qna_id}` | Bearer JWT | Tenant scope check | None | `{ status: "success", message }` | 403/404/500 | None |
| `frontend/app/dashboard/access-groups/[group_id]/content/page.tsx` | `GET /content/{content_type}/{content_id}/groups` | Bearer JWT | Twin access | None | `Array<AccessGroupSchema>` | 401/403 | None |

Access groups and permissions

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/dashboard/access-groups/page.tsx` | `GET /access-groups` | Bearer JWT | Tenant scope | None | Unknown | 404 | Backend expects `/twins/{twin_id}/access-groups` |
| `frontend/app/dashboard/access-groups/page.tsx` | `POST /access-groups` | Bearer JWT | Tenant scope | `{ name, description?, is_public?, settings? }` | Unknown | 404 | Backend expects `/twins/{twin_id}/access-groups` |
| `frontend/app/dashboard/access-groups/page.tsx` | `DELETE /access-groups/{group_id}` | Bearer JWT | Tenant scope | None | `{ status: "success" }` | 401/403/404 | FE uses tenant-scoped fetch; backend uses group ownership by twin |
| `frontend/app/dashboard/access-groups/[group_id]/members/page.tsx` | `GET /access-groups/{group_id}` | Bearer JWT | Group ownership | None | `AccessGroupSchema` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/members/page.tsx` | `GET /access-groups/{group_id}/members` | Bearer JWT | Group ownership | None | `Array<GroupMembershipSchema>` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/members/page.tsx` | `POST /twins/{twin_id}/group-memberships` | Bearer JWT | Twin access | `{ user_id: string, group_id: string }` | `GroupMembershipSchema` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/members/page.tsx` | `DELETE /group-memberships/{membership_id}` | Bearer JWT | Group ownership | None | `{ status: "success" }` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/content/page.tsx` | `GET /access-groups/{group_id}/permissions` | Bearer JWT | Group ownership | None | `Array<ContentPermissionSchema>` | 401/403 | None |
| `frontend/app/dashboard/access-groups/[group_id]/content/page.tsx` | `POST /access-groups/{group_id}/permissions` | Bearer JWT | Group ownership | `{ content_type: "source"|"verified_qna", content_ids: string[] }` | `{ status: "success", added: number }` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/content/page.tsx` | `DELETE /access-groups/{group_id}/permissions/{content_type}/{content_id}` | Bearer JWT | Group ownership | None | `{ status: "success" }` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/settings/page.tsx` | `POST /access-groups/{group_id}/limits` | Bearer JWT | Group ownership | Query `limit_type`, `limit_value` | `GroupLimitSchema` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/settings/page.tsx` | `GET /access-groups/{group_id}/limits` | Bearer JWT | Group ownership | None | `Array<GroupLimitSchema>` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/settings/page.tsx` | `POST /access-groups/{group_id}/overrides` | Bearer JWT | Group ownership | `{ override_type, override_value }` | `GroupOverrideSchema` | 401/403/404 | None |
| `frontend/app/dashboard/access-groups/[group_id]/settings/page.tsx` | `GET /access-groups/{group_id}/overrides` | Bearer JWT | Group ownership | None | `Array<GroupOverrideSchema>` | 401/403/404 | None |
Actions, governance, escalations

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/dashboard/actions/page.tsx`, `frontend/app/dashboard/actions/triggers/page.tsx` | `GET /twins/{twin_id}/triggers` | Bearer JWT | Twin access | None | `Array<ActionTriggerSchema>` | 401/403 | None |
| `frontend/app/dashboard/actions/triggers/page.tsx` | `POST /twins/{twin_id}/triggers` | Bearer JWT | Twin access | `TriggerCreateRequest` | `ActionTriggerSchema` | 401/403/500 | None |
| `frontend/app/dashboard/actions/triggers/page.tsx` | `PUT /twins/{twin_id}/triggers/{trigger_id}` | Bearer JWT | Twin access | `TriggerUpdateRequest` | `ActionTriggerSchema` | 401/403/500 | None |
| `frontend/app/dashboard/actions/triggers/page.tsx` | `DELETE /twins/{twin_id}/triggers/{trigger_id}` | Bearer JWT | Twin access | None | `{ status: "success" }` | 401/403/500 | None |
| `frontend/app/dashboard/actions/inbox/page.tsx`, `frontend/app/dashboard/actions/page.tsx` | `GET /twins/{twin_id}/action-drafts` | Bearer JWT | Twin access | None | `Array<ActionDraftSchema>` | 401/403 | None |
| `frontend/app/dashboard/actions/inbox/page.tsx` | `GET /twins/{twin_id}/action-drafts-all` | Bearer JWT | Twin access | None | `Array<ActionDraftSchema>` | 401/403 | None |
| `frontend/app/dashboard/actions/inbox/page.tsx` | `POST /twins/{twin_id}/action-drafts/{draft_id}/approve` | Bearer JWT | Twin access | `{ approval_note? }` | `{ status: "approved" }` | 401/403/404 | None |
| `frontend/app/dashboard/actions/inbox/page.tsx` | `POST /twins/{twin_id}/action-drafts/{draft_id}/reject` | Bearer JWT | Twin access | `{ rejection_note? }` | `{ status: "rejected" }` | 401/403/404 | None |
| `frontend/app/dashboard/actions/inbox/page.tsx` | `POST /twins/{twin_id}/action-drafts/{draft_id}/respond` | Bearer JWT | Twin access | `{ response_message, save_as_verified? }` | `{ status: "responded" }` | 401/403/404 | None |
| `frontend/app/dashboard/actions/history/page.tsx`, `frontend/app/dashboard/actions/page.tsx` | `GET /twins/{twin_id}/executions` | Bearer JWT | Twin access | Query `limit?` | `Array<ActionExecutionSchema>` | 401/403 | None |
| `frontend/app/dashboard/actions/connectors/page.tsx` | `GET /twins/{twin_id}/connectors` | Bearer JWT | Twin access | None | `Array<ToolConnectorSchema>` | 401/403 | None |
| `frontend/app/dashboard/actions/connectors/page.tsx` | `POST /twins/{twin_id}/connectors` | Bearer JWT | Twin access | `ConnectorCreateRequest` | `ToolConnectorSchema` | 401/403/500 | None |
| `frontend/app/dashboard/actions/connectors/page.tsx` | `DELETE /twins/{twin_id}/connectors/{connector_id}` | Bearer JWT | Twin access | None | `{ status: "success" }` | 401/403/404 | None |
| `frontend/app/dashboard/actions/connectors/page.tsx` | `POST /twins/{twin_id}/connectors/{connector_id}/test` | Bearer JWT | Twin access | None | `ConnectorTestResponse` | 401/403/404 | None |
| `frontend/app/dashboard/governance/page.tsx` | `GET /governance/audit-logs` | Bearer JWT | Tenant scope, optional `twin_id` filter | Query `twin_id?` | `Array<AuditLogSchema>` | 401/403 | None |
| `frontend/app/dashboard/governance/page.tsx` | `GET /governance/policies` | Bearer JWT | Tenant scope | None | `Array<GovernancePolicySchema>` | 401/403 | None |
| `frontend/app/dashboard/governance/page.tsx` | `POST /governance/policies` | Bearer JWT | Tenant scope | `GovernancePolicyCreateRequest` | `GovernancePolicySchema` | 401/403/500 | None |
| `frontend/app/dashboard/governance/page.tsx` | `POST /twins/{twin_id}/governance/verify` | Bearer JWT | Twin access | `TwinVerificationRequest` | `TwinVerificationSchema` | 401/403/500 | None |
| `frontend/app/dashboard/governance/page.tsx` | `DELETE /twins/{twin_id}/sources/{source_id}/deep-scrub` | Bearer JWT | Twin access | None | `{ status: "success" }` | 401/403/500 | None |
| `frontend/app/dashboard/governance/page.tsx` | `GET /twins/{twin_id}/sources` | Bearer JWT | Twin access | None | Unknown | 404 | Backend route is `/sources/{twin_id}` |
| `frontend/app/dashboard/escalations/page.tsx` | `GET /twins/{twin_id}/escalations` | Bearer JWT | Twin access | None | `Array<EscalationSchema>` | 401/403 | None |
| `frontend/app/dashboard/escalations/page.tsx` | `GET /escalations` | Bearer JWT | Tenant scope (admin) | None | `Array<EscalationSchema>` | 401/403 | None |
| `frontend/app/dashboard/escalations/page.tsx` | `POST /escalations/{escalation_id}/resolve` | Bearer JWT | Tenant scope | `{ resolution: string }` | `{ status: "resolved" }` | 401/403/404 | None |

Metrics, jobs, audio, feedback, reasoning

| Frontend call site(s) | Backend route | Auth + headers | Tenant/twin scoping | Request schema | Response schema | Errors/status | Drift |
| --- | --- | --- | --- | --- | --- | --- | --- |
| `frontend/app/dashboard/page.tsx`, `frontend/app/dashboard/insights/page.tsx`, `frontend/app/dashboard/metrics/page.tsx` | `GET /metrics/dashboard/{twin_id}` | Bearer JWT | Twin access | Query `days?` | `DashboardStats` | 401/403 | FE often uses raw fetch without auth |
| `frontend/app/dashboard/page.tsx`, `frontend/app/dashboard/insights/page.tsx` | `GET /metrics/activity/{twin_id}` | Bearer JWT | Twin access | Query `limit?` | `Array<ActivityItem>` | 401/403 | FE uses raw fetch without auth |
| `frontend/app/dashboard/page.tsx` | `GET /metrics/conversations/{twin_id}` | Bearer JWT | Twin access | Query `limit?` | `Array<ConversationSummary>` | 401/403 | FE uses raw fetch without auth |
| `frontend/app/dashboard/insights/page.tsx` | `GET /metrics/daily/{twin_id}` | Bearer JWT | Twin access | Query `days?` | `Array<DailyMetric>` | 401/403 | FE uses raw fetch without auth |
| `frontend/app/dashboard/insights/page.tsx` | `GET /metrics/top-questions/{twin_id}` | Bearer JWT | Twin access | Query `limit?` | `Array<TopQuestion>` | 401/403 | FE uses raw fetch without auth |
| `frontend/app/dashboard/metrics/page.tsx` | `GET /metrics/usage/{twin_id}` | Bearer JWT | Twin access | None | `{ tokens, cost, ... }` | 401/403 | None |
| `frontend/app/dashboard/metrics/page.tsx` | `GET /metrics/health` | Bearer JWT | Owner only | None | `{ status, ... }` | 401/403 | None |
| `frontend/app/dashboard/metrics/page.tsx` | `GET /metrics/quota/{tenant_id}` | Bearer JWT | Tenant scope | None | `{ quota, usage }` | 401/403 | None |
| `frontend/app/dashboard/jobs/page.tsx` | `GET /jobs` | Bearer JWT | Tenant scope | Query `limit?` | `Array<JobResponse>` | 401/403 | None |
| `frontend/app/dashboard/jobs/[id]/page.tsx` | `GET /jobs/{job_id}` | Bearer JWT | Tenant scope | None | `JobResponse` | 401/403/404 | None |
| `frontend/app/dashboard/jobs/[id]/page.tsx` | `GET /jobs/{job_id}/logs` | Bearer JWT | Tenant scope | None | `Array<JobLogResponse>` | 401/403/404 | None |
| `frontend/app/dashboard/settings/page.tsx` | `POST /audio/tts/{twin_id}` | Bearer JWT | Twin access | `{ text: string, voice?: string }` | `{ audio_url }` | 401/403/500 | None |
| `frontend/app/dashboard/settings/page.tsx` | `GET /audio/voices` | Bearer JWT | Tenant scope | None | `Array<Voice>` | 401/403 | None |
| `frontend/app/dashboard/settings/page.tsx` | `GET /audio/settings/{twin_id}` | Bearer JWT | Twin access | None | `{ voice, speed, ... }` | 401/403 | None |
| `frontend/app/dashboard/settings/page.tsx` | `PUT /audio/settings/{twin_id}` | Bearer JWT | Twin access | `{ voice, speed, ... }` | `{ status: "success" }` | 401/403 | None |
| `frontend/components/FeedbackWidget.tsx` | `POST /api/feedback/{trace_id}` | None | N/A | `{ score: -1|1, reason: string, comment?, message_id? }` | Unknown | 404 | Backend route is `/feedback/{trace_id}`; FE calls Next API path |
| `frontend/components/console/tabs/ChatTab.tsx` | `POST /debug/retrieval` | None | N/A | `{ query, twin_id }` | `{ contexts }` | 401/403 | FE call lacks auth; backend requires owner |
| `frontend/components/console/tabs/ChatTab.tsx` | `POST /verify/twins/{twin_id}/run` | None | Twin access | None | `VerifyResponse` | 401/403 | FE call lacks auth |
| `frontend/components/Chat/InterviewInterface.tsx` | `POST /cognitive/interview/{twin_id}` | Bearer JWT | Twin access | `{ response, confidence?, extracted_data?, conversation_id? }` | `InterviewResponse` | 401/403/500 | None |
| `frontend/lib/hooks/useRealtimeInterview.ts` | `POST /api/interview/sessions` | Bearer JWT | Tenant scope | `{ twin_id, group_id?, session_type, user_id? }` | `CreateSessionResponse` | 401/403 | None |
| `frontend/lib/hooks/useRealtimeInterview.ts` | `POST /api/interview/realtime/sessions` | Bearer JWT | Tenant scope | `{ twin_id, group_id?, session_type, user_id? }` | `RealtimeSessionResponse` | 401/403 | None |
| `frontend/lib/hooks/useRealtimeInterview.ts` | `POST /api/interview/sessions/{id}/finalize` | Bearer JWT | Tenant scope | `{ session_id, transcript }` | `FinalizeSessionResponse` | 401/403 | None |

**Backend Routes Without Frontend Calls**

- `GET /auth/me`, `GET /auth/whoami` (no FE usage).
- `PATCH /api-keys/{key_id}` (twin-scoped API keys in `backend/routers/auth.py`, not used in FE).
- Tenant API keys endpoints in `backend/routers/api_keys.py` are used; the twin API key endpoints in `backend/routers/auth.py` overlap and are not referenced by FE.
- `GET /twins/{twin_id}/graph-job-status` (no FE usage).
- `POST /twins/{twin_id}/archive`, `DELETE /twins/{twin_id}` (no FE usage in current UI).
- `POST /twins/{twin_id}/nodes` (manual graph node creation; no FE usage).
- `GET /metrics/events/{user_id}`, `POST /metrics/events`, `GET /metrics/system`, `POST /metrics/quota/{tenant_id}/set` (no FE usage).
- `POST /reason/predict/{twin_id}` (no FE usage).
- `GET /observability/health` (no FE usage).
- `POST /youtube/preflight` (no FE usage).
- Enhanced ingestion: `/ingest/website/*`, `/ingest/rss/*`, `/ingest/twitter/*`, `/ingest/linkedin/*`, `/pipelines/*` (no FE usage).
- `GET /api/interview/context` (no FE usage).
- `GET /feedback/reasons` (no FE usage).
- `GET /cognitive/graph/{twin_id}` and `/cognitive/profiles/{twin_id}/versions*` (only used in `frontend/app/dashboard/brain/page.tsx`; not part of critical path).
- Conditional VC route: `POST /api/vc/artifact/upload/{twin_id}` (only when `ENABLE_VC_ROUTES=true`).

**Notes on Evidence**

Evidence for frontend call sites is from `rg "fetch"` results and direct file inspection of the call sites listed above (e.g., `frontend/components/ingestion/UnifiedIngestion.tsx`, `frontend/app/onboarding/page.tsx`). Backend route definitions are in `backend/routers/*.py` and `backend/main.py`.

**Canonical Contracts**

See `docs/CDR-001-canonical-contracts.md` for Phase 1 immutable decisions.

**Phase 2 Compatibility Shims (Implemented)**

- Added deprecated shim `POST /ingest/document` (form-data with `file` + `twin_id`) -> forwards to `/ingest/file/{twin_id}`.
- Added deprecated shim `POST /ingest/url` (JSON `{ url, twin_id }`) -> forwards to `/ingest/url/{twin_id}`.
- Streaming chat schema now emits canonical events (`metadata`, `content`, `clarify`, `done`, `error`) with `token` field for `content`. Legacy `content` field is also included for compatibility.
- `/chat` and `/chat-widget` accept legacy `{ message }` payloads and map to `query`.
- `/sources/{source_id}/reject` accepts query `reason` or JSON `{ reason }`.
- `/sources/bulk-approve` accepts raw `string[]` or `{ source_ids: string[] }`.
- `/sources/{source_id}/health` includes `checks: []` in response.
- Added training jobs observability routes: `GET /training-jobs?twin_id=...` and `POST /training-jobs/{job_id}/retry`.
